年齢 = "年齢_歳.発生届",
生年月日 = "生年月日.ID管理",
性別 = "性別.発生届",
居住都道府県 = "都道府県.ID管理",
居住市区町村 = "居所の住所_市区町村.ID管理",
発症日 = "発病年月日.発生届",
診断日 = "診断年月日.発生届",
報告日 = "報告年月日.発生届",
感染推定日 = "感染推定日.発生届",
症状_発熱 = "症状等_発熱.発生届",
症状_咳 = "症状等_咳.発生届",
症状_咳以外の急性呼吸器症状 = "症状等_咳以外の急性呼吸器症状.発生届",
症状_肺炎像 = "症状等_肺炎像.発生届",
症状_重篤な肺炎 = "症状等_重篤な肺炎.発生届",
症状_急性呼吸窮迫症候群 = "症状等_急性呼吸窮迫症候群.発生届",
症状_多臓器不全 = "症状等_多臓器不全.発生届",
症状_全身倦怠感 = "症状等_全身倦怠感.発生届",
症状_頭痛 = "症状等_頭痛.発生届",
症状_嘔気嘔吐 = "症状等_嘔気.嘔吐.発生届",
症状_下痢 = "症状等_下痢.発生届",
症状_結膜炎 = "症状等_結膜炎.発生届",
症状_嗅覚味覚障害 = "症状等_嗅覚.味覚障害.発生届",
症状_その他 = "症状等_その他症状.発生届",
入院の必要性 = "入院の必要性.基礎情報",
検体採取日 = "PCR検体採取_日付.措置判定記録",
入院日_発生届 = "入院年月日.発生届",
入院日_医療連携情報= "入院_入院日付.医療連携情報",
入院日_措置判定記録 = "入院_日付.措置判定記録",
退院日_医療連携情報 = "入院_退院日付.医療連携情報",
退院日_措置判定記録 = "退院_日付.措置判定記録",
死亡日_医療連携情報 = "入院_死亡年月日.医療連携情報",
死亡日_措置判定記録 = "死亡_日付.措置判定記録",
外来機関コード_検査記録 = "外来機関コード.検査記録",
検査機関コード_検査記録 = "検査機関コード.検査記録",
診断医療機関コード_医療連携情報 = "診断_診断医療機関コード.医療連携情報",
入院病院コード = "入院_病院コード.医療連携情報",
届出保健所コード = "届出先保健所コード.発生届",
担当保健所コード = "担当保健所コード.ID管理",
感染経路_飛沫飛沫核感染 = "感染経路_フラグ.飛沫.飛沫核感染..発生届",
感染経路_接触感染 = "感染経路_フラグ.接触感染..発生届",
感染経路_その他 = "感染経路_フラグ.その他..発生届",
感染地域_確度 = "感染地域_確度コード.発生届",
感染経路_確度 = "感染経路_確度コード.発生届",
推定感染地域_都道府県コード = "感染地域_国内_都道府県コード.発生届",
推定感染地域_市区町村コード = "感染地域_国内_市区町村コード.発生届",
推定感染地域_場所区分 = "感染地域_国内_場所区分コード.発生届",
推定感染地域_国コード = "感染地域_国外_国コード.発生届",
リンク有無 = "リンクの有無.発生届",
検査_1_発生届 = "検査記録_検査1_検査結果.発生届",
検査_2_発生届 = "検査記録_検査2_検査結果.発生届",
検査_3_発生届 = "検査記録_検査3_検査結果.発生届",
検査_4_発生届 = "検査記録_検査4_検査結果.発生届",
検査_1_検査記録 = "検査1_検査結果.検査記録",
検査_2_検査記録 = "検査2_検査結果.検査記録",
検査_3_検査記録 = "検査3_検査結果.検査記録",
検査_4_検査記録 = "検査4_検査結果.検査記録",
検査方法1_検査記録 = "検査1_検査方法.検査記録",
検査方法2_検査記録 = "検査2_検査方法.検査記録",
検査方法3_検査記録 = "検査3_検査方法.検査記録",
検査方法4_検査記録 = "検査4_検査方法.検査記録",
検査方法1_発生届 = "検査記録_検査1_検査方法.発生届",
検査方法2_発生届 = "検査記録_検査2_検査方法.発生届",
検査方法3_発生届 = "検査記録_検査3_検査方法.発生届",
検査方法4_発生届 = "検査記録_検査4_検査方法.発生届",
検査検体1_検査記録 = "検査1_検体.検査記録",
検査検体2_検査記録 = "検査2_検体.検査記録",
検査検体3_検査記録 = "検査3_検体.検査記録",
検査検体4_検査記録 = "検査4_検体.検査記録",
検査検体1_発生届 = "検査記録_検査1_検体.発生届",
検査検体2_発生届 = "検査記録_検査2_検体.発生届",
検査検体3_発生届 = "検査記録_検査3_検体.発生届",
検査検体4_発生届 = "検査記録_検査4_検体.発生届",
診断類型 = "診断類型.発生届",
現在のステータス = "現在のステータス.措置判定記録"
) %>%
mutate(届出保健所コード=as.numeric(届出保健所コード),
担当保健所コード=as.numeric(担当保健所コード)) %>%
mutate_at(vars(発症日,診断日,報告日,生年月日,感染推定日),~as.Date(.)) %>%
filter(診断類型==1|診断類型==2|診断類型==4|
検査_1_発生届==2|  検査_2_発生届==2|  検査_3_発生届==2|  検査_4_発生届==2|
検査_1_検査記録==2|  検査_2_検査記録==2|  検査_3_検査記録==2|  検査_4_検査記録==2) %>%
filter(診断日 >= "2021-03-01") %>%
arrange(診断日)
return(d_)
}
get_load_df <- function(file_pass){
d_ <- read.csv(file(file_pass)) %>%
rename(ID = "HER.SYS.ID.ID管理",
年齢 = "年齢_歳.発生届",
生年月日 = "生年月日.ID管理",
性別 = "性別.発生届",
居住都道府県 = "都道府県.ID管理",
居住市区町村 = "居所の住所_市区町村.ID管理",
発症日 = "発病年月日.発生届",
診断日 = "診断年月日.発生届",
報告日 = "報告年月日.発生届",
感染推定日 = "感染推定日.発生届",
症状_発熱 = "症状等_発熱.発生届",
症状_咳 = "症状等_咳.発生届",
症状_咳以外の急性呼吸器症状 = "症状等_咳以外の急性呼吸器症状.発生届",
症状_肺炎像 = "症状等_肺炎像.発生届",
症状_重篤な肺炎 = "症状等_重篤な肺炎.発生届",
症状_急性呼吸窮迫症候群 = "症状等_急性呼吸窮迫症候群.発生届",
症状_多臓器不全 = "症状等_多臓器不全.発生届",
症状_全身倦怠感 = "症状等_全身倦怠感.発生届",
症状_頭痛 = "症状等_頭痛.発生届",
症状_嘔気嘔吐 = "症状等_嘔気.嘔吐.発生届",
症状_下痢 = "症状等_下痢.発生届",
症状_結膜炎 = "症状等_結膜炎.発生届",
症状_嗅覚味覚障害 = "症状等_嗅覚.味覚障害.発生届",
症状_その他 = "症状等_その他症状.発生届",
入院の必要性 = "入院の必要性.基礎情報",
検体採取日 = "PCR検体採取_日付.措置判定記録",
入院日_発生届 = "入院年月日.発生届",
入院日_医療連携情報= "入院_入院日付.医療連携情報",
入院日_措置判定記録 = "入院_日付.措置判定記録",
退院日_医療連携情報 = "入院_退院日付.医療連携情報",
退院日_措置判定記録 = "退院_日付.措置判定記録",
死亡日_医療連携情報 = "入院_死亡年月日.医療連携情報",
死亡日_措置判定記録 = "死亡_日付.措置判定記録",
外来機関コード_検査記録 = "外来機関コード.検査記録",
検査機関コード_検査記録 = "検査機関コード.検査記録",
診断医療機関コード_医療連携情報 = "診断_診断医療機関コード.医療連携情報",
入院病院コード = "入院_病院コード.医療連携情報",
届出保健所コード = "届出先保健所コード.発生届",
担当保健所コード = "担当保健所コード.ID管理",
感染経路_飛沫飛沫核感染 = "感染経路_フラグ.飛沫.飛沫核感染..発生届",
感染経路_接触感染 = "感染経路_フラグ.接触感染..発生届",
感染経路_その他 = "感染経路_フラグ.その他..発生届",
感染地域_確度 = "感染地域_確度コード.発生届",
感染経路_確度 = "感染経路_確度コード.発生届",
推定感染地域_都道府県コード = "感染地域_国内_都道府県コード.発生届",
推定感染地域_市区町村コード = "感染地域_国内_市区町村コード.発生届",
推定感染地域_場所区分 = "感染地域_国内_場所区分コード.発生届",
推定感染地域_国コード = "感染地域_国外_国コード.発生届",
リンク有無 = "リンクの有無.発生届",
検査_1_発生届 = "検査記録_検査1_検査結果.発生届",
検査_2_発生届 = "検査記録_検査2_検査結果.発生届",
検査_3_発生届 = "検査記録_検査3_検査結果.発生届",
検査_4_発生届 = "検査記録_検査4_検査結果.発生届",
検査_1_検査記録 = "検査1_検査結果.検査記録",
検査_2_検査記録 = "検査2_検査結果.検査記録",
検査_3_検査記録 = "検査3_検査結果.検査記録",
検査_4_検査記録 = "検査4_検査結果.検査記録",
検査方法1_検査記録 = "検査1_検査方法.検査記録",
検査方法2_検査記録 = "検査2_検査方法.検査記録",
検査方法3_検査記録 = "検査3_検査方法.検査記録",
検査方法4_検査記録 = "検査4_検査方法.検査記録",
検査方法1_発生届 = "検査記録_検査1_検査方法.発生届",
検査方法2_発生届 = "検査記録_検査2_検査方法.発生届",
検査方法3_発生届 = "検査記録_検査3_検査方法.発生届",
検査方法4_発生届 = "検査記録_検査4_検査方法.発生届",
検査検体1_検査記録 = "検査1_検体.検査記録",
検査検体2_検査記録 = "検査2_検体.検査記録",
検査検体3_検査記録 = "検査3_検体.検査記録",
検査検体4_検査記録 = "検査4_検体.検査記録",
検査検体1_発生届 = "検査記録_検査1_検体.発生届",
検査検体2_発生届 = "検査記録_検査2_検体.発生届",
検査検体3_発生届 = "検査記録_検査3_検体.発生届",
検査検体4_発生届 = "検査記録_検査4_検体.発生届",
診断類型 = "診断類型.発生届",
現在のステータス = "現在のステータス.措置判定記録"
) %>%
mutate(届出保健所コード=as.numeric(届出保健所コード),
担当保健所コード=as.numeric(担当保健所コード)) %>%
mutate_at(vars(発症日,診断日,報告日,生年月日,感染推定日),~as.Date(.)) %>%
filter(診断類型==1|診断類型==2|診断類型==4|
検査_1_発生届==2|  検査_2_発生届==2|  検査_3_発生届==2|  検査_4_発生届==2|
検査_1_検査記録==2|  検査_2_検査記録==2|  検査_3_検査記録==2|  検査_4_検査記録==2) %>%
filter(診断日 >= "2021-03-01") %>%
arrange(診断日)
return(d_)
}
d0 <- get_load_df(paste("./hersys_rawdata/hersys21",today,"取扱注意-0-2.csv",sep = ""),encoding='cp932')
get_load_df <- function(file_pass){
d_ <- read.csv(file(file_pass,,encoding='cp932')) %>%
rename(ID = "HER.SYS.ID.ID管理",
年齢 = "年齢_歳.発生届",
生年月日 = "生年月日.ID管理",
性別 = "性別.発生届",
居住都道府県 = "都道府県.ID管理",
居住市区町村 = "居所の住所_市区町村.ID管理",
発症日 = "発病年月日.発生届",
診断日 = "診断年月日.発生届",
報告日 = "報告年月日.発生届",
感染推定日 = "感染推定日.発生届",
症状_発熱 = "症状等_発熱.発生届",
症状_咳 = "症状等_咳.発生届",
症状_咳以外の急性呼吸器症状 = "症状等_咳以外の急性呼吸器症状.発生届",
症状_肺炎像 = "症状等_肺炎像.発生届",
症状_重篤な肺炎 = "症状等_重篤な肺炎.発生届",
症状_急性呼吸窮迫症候群 = "症状等_急性呼吸窮迫症候群.発生届",
症状_多臓器不全 = "症状等_多臓器不全.発生届",
症状_全身倦怠感 = "症状等_全身倦怠感.発生届",
症状_頭痛 = "症状等_頭痛.発生届",
症状_嘔気嘔吐 = "症状等_嘔気.嘔吐.発生届",
症状_下痢 = "症状等_下痢.発生届",
症状_結膜炎 = "症状等_結膜炎.発生届",
症状_嗅覚味覚障害 = "症状等_嗅覚.味覚障害.発生届",
症状_その他 = "症状等_その他症状.発生届",
入院の必要性 = "入院の必要性.基礎情報",
検体採取日 = "PCR検体採取_日付.措置判定記録",
入院日_発生届 = "入院年月日.発生届",
入院日_医療連携情報= "入院_入院日付.医療連携情報",
入院日_措置判定記録 = "入院_日付.措置判定記録",
退院日_医療連携情報 = "入院_退院日付.医療連携情報",
退院日_措置判定記録 = "退院_日付.措置判定記録",
死亡日_医療連携情報 = "入院_死亡年月日.医療連携情報",
死亡日_措置判定記録 = "死亡_日付.措置判定記録",
外来機関コード_検査記録 = "外来機関コード.検査記録",
検査機関コード_検査記録 = "検査機関コード.検査記録",
診断医療機関コード_医療連携情報 = "診断_診断医療機関コード.医療連携情報",
入院病院コード = "入院_病院コード.医療連携情報",
届出保健所コード = "届出先保健所コード.発生届",
担当保健所コード = "担当保健所コード.ID管理",
感染経路_飛沫飛沫核感染 = "感染経路_フラグ.飛沫.飛沫核感染..発生届",
感染経路_接触感染 = "感染経路_フラグ.接触感染..発生届",
感染経路_その他 = "感染経路_フラグ.その他..発生届",
感染地域_確度 = "感染地域_確度コード.発生届",
感染経路_確度 = "感染経路_確度コード.発生届",
推定感染地域_都道府県コード = "感染地域_国内_都道府県コード.発生届",
推定感染地域_市区町村コード = "感染地域_国内_市区町村コード.発生届",
推定感染地域_場所区分 = "感染地域_国内_場所区分コード.発生届",
推定感染地域_国コード = "感染地域_国外_国コード.発生届",
リンク有無 = "リンクの有無.発生届",
検査_1_発生届 = "検査記録_検査1_検査結果.発生届",
検査_2_発生届 = "検査記録_検査2_検査結果.発生届",
検査_3_発生届 = "検査記録_検査3_検査結果.発生届",
検査_4_発生届 = "検査記録_検査4_検査結果.発生届",
検査_1_検査記録 = "検査1_検査結果.検査記録",
検査_2_検査記録 = "検査2_検査結果.検査記録",
検査_3_検査記録 = "検査3_検査結果.検査記録",
検査_4_検査記録 = "検査4_検査結果.検査記録",
検査方法1_検査記録 = "検査1_検査方法.検査記録",
検査方法2_検査記録 = "検査2_検査方法.検査記録",
検査方法3_検査記録 = "検査3_検査方法.検査記録",
検査方法4_検査記録 = "検査4_検査方法.検査記録",
検査方法1_発生届 = "検査記録_検査1_検査方法.発生届",
検査方法2_発生届 = "検査記録_検査2_検査方法.発生届",
検査方法3_発生届 = "検査記録_検査3_検査方法.発生届",
検査方法4_発生届 = "検査記録_検査4_検査方法.発生届",
検査検体1_検査記録 = "検査1_検体.検査記録",
検査検体2_検査記録 = "検査2_検体.検査記録",
検査検体3_検査記録 = "検査3_検体.検査記録",
検査検体4_検査記録 = "検査4_検体.検査記録",
検査検体1_発生届 = "検査記録_検査1_検体.発生届",
検査検体2_発生届 = "検査記録_検査2_検体.発生届",
検査検体3_発生届 = "検査記録_検査3_検体.発生届",
検査検体4_発生届 = "検査記録_検査4_検体.発生届",
診断類型 = "診断類型.発生届",
現在のステータス = "現在のステータス.措置判定記録"
) %>%
mutate(届出保健所コード=as.numeric(届出保健所コード),
担当保健所コード=as.numeric(担当保健所コード)) %>%
mutate_at(vars(発症日,診断日,報告日,生年月日,感染推定日),~as.Date(.)) %>%
filter(診断類型==1|診断類型==2|診断類型==4|
検査_1_発生届==2|  検査_2_発生届==2|  検査_3_発生届==2|  検査_4_発生届==2|
検査_1_検査記録==2|  検査_2_検査記録==2|  検査_3_検査記録==2|  検査_4_検査記録==2) %>%
filter(診断日 >= "2021-03-01") %>%
arrange(診断日)
return(d_)
}
d0 <- get_load_df(paste("./hersys_rawdata/hersys21",today,"取扱注意-0-2.csv",sep = ""))
View(d0)
d1 <- get_load_df(paste("./hersys_rawdata/hersys21",today,"取扱注意-3-5.csv",sep = ""))
d2 <- get_load_df(paste("./hersys_rawdata/hersys21",today,"取扱注意-6.csv",sep = ""))
d3 <- get_load_df(paste("./hersys_rawdata/hersys21",today,"取扱注意-7.csv",sep = ""))
get_load_df <- function(file_pass){
d_ <- read.csv(file(file_pass,encoding='cp932')) %>%
rename(ID = "HER.SYS.ID.ID管理",
年齢 = "年齢_歳.発生届",
生年月日 = "生年月日.ID管理",
性別 = "性別.発生届",
居住都道府県 = "都道府県.ID管理",
居住市区町村 = "居所の住所_市区町村.ID管理",
発症日 = "発病年月日.発生届",
診断日 = "診断年月日.発生届",
報告日 = "報告年月日.発生届",
感染推定日 = "感染推定日.発生届",
症状_発熱 = "症状等_発熱.発生届",
症状_咳 = "症状等_咳.発生届",
症状_咳以外の急性呼吸器症状 = "症状等_咳以外の急性呼吸器症状.発生届",
症状_肺炎像 = "症状等_肺炎像.発生届",
症状_重篤な肺炎 = "症状等_重篤な肺炎.発生届",
症状_急性呼吸窮迫症候群 = "症状等_急性呼吸窮迫症候群.発生届",
症状_多臓器不全 = "症状等_多臓器不全.発生届",
症状_全身倦怠感 = "症状等_全身倦怠感.発生届",
症状_頭痛 = "症状等_頭痛.発生届",
症状_嘔気嘔吐 = "症状等_嘔気.嘔吐.発生届",
症状_下痢 = "症状等_下痢.発生届",
症状_結膜炎 = "症状等_結膜炎.発生届",
症状_嗅覚味覚障害 = "症状等_嗅覚.味覚障害.発生届",
症状_その他 = "症状等_その他症状.発生届",
入院の必要性 = "入院の必要性.基礎情報",
検体採取日 = "PCR検体採取_日付.措置判定記録",
入院日_発生届 = "入院年月日.発生届",
入院日_医療連携情報= "入院_入院日付.医療連携情報",
入院日_措置判定記録 = "入院_日付.措置判定記録",
退院日_医療連携情報 = "入院_退院日付.医療連携情報",
退院日_措置判定記録 = "退院_日付.措置判定記録",
死亡日_医療連携情報 = "入院_死亡年月日.医療連携情報",
死亡日_措置判定記録 = "死亡_日付.措置判定記録",
外来機関コード_検査記録 = "外来機関コード.検査記録",
検査機関コード_検査記録 = "検査機関コード.検査記録",
診断医療機関コード_医療連携情報 = "診断_診断医療機関コード.医療連携情報",
入院病院コード = "入院_病院コード.医療連携情報",
届出保健所コード = "届出先保健所コード.発生届",
担当保健所コード = "担当保健所コード.ID管理",
感染経路_飛沫飛沫核感染 = "感染経路_フラグ.飛沫.飛沫核感染..発生届",
感染経路_接触感染 = "感染経路_フラグ.接触感染..発生届",
感染経路_その他 = "感染経路_フラグ.その他..発生届",
感染地域_確度 = "感染地域_確度コード.発生届",
感染経路_確度 = "感染経路_確度コード.発生届",
推定感染地域_都道府県コード = "感染地域_国内_都道府県コード.発生届",
推定感染地域_市区町村コード = "感染地域_国内_市区町村コード.発生届",
推定感染地域_場所区分 = "感染地域_国内_場所区分コード.発生届",
推定感染地域_国コード = "感染地域_国外_国コード.発生届",
リンク有無 = "リンクの有無.発生届",
検査_1_発生届 = "検査記録_検査1_検査結果.発生届",
検査_2_発生届 = "検査記録_検査2_検査結果.発生届",
検査_3_発生届 = "検査記録_検査3_検査結果.発生届",
検査_4_発生届 = "検査記録_検査4_検査結果.発生届",
検査_1_検査記録 = "検査1_検査結果.検査記録",
検査_2_検査記録 = "検査2_検査結果.検査記録",
検査_3_検査記録 = "検査3_検査結果.検査記録",
検査_4_検査記録 = "検査4_検査結果.検査記録",
検査方法1_検査記録 = "検査1_検査方法.検査記録",
検査方法2_検査記録 = "検査2_検査方法.検査記録",
検査方法3_検査記録 = "検査3_検査方法.検査記録",
検査方法4_検査記録 = "検査4_検査方法.検査記録",
検査方法1_発生届 = "検査記録_検査1_検査方法.発生届",
検査方法2_発生届 = "検査記録_検査2_検査方法.発生届",
検査方法3_発生届 = "検査記録_検査3_検査方法.発生届",
検査方法4_発生届 = "検査記録_検査4_検査方法.発生届",
検査検体1_検査記録 = "検査1_検体.検査記録",
検査検体2_検査記録 = "検査2_検体.検査記録",
検査検体3_検査記録 = "検査3_検体.検査記録",
検査検体4_検査記録 = "検査4_検体.検査記録",
検査検体1_発生届 = "検査記録_検査1_検体.発生届",
検査検体2_発生届 = "検査記録_検査2_検体.発生届",
検査検体3_発生届 = "検査記録_検査3_検体.発生届",
検査検体4_発生届 = "検査記録_検査4_検体.発生届",
診断類型 = "診断類型.発生届",
現在のステータス = "現在のステータス.措置判定記録"
) %>%
mutate(届出保健所コード=as.numeric(届出保健所コード),
担当保健所コード=as.numeric(担当保健所コード)) %>%
mutate_at(vars(発症日,診断日,報告日,生年月日,感染推定日),~as.Date(.)) %>%
filter(診断類型==1|診断類型==2|診断類型==4|
検査_1_発生届==2|  検査_2_発生届==2|  検査_3_発生届==2|  検査_4_発生届==2|
検査_1_検査記録==2|  検査_2_検査記録==2|  検査_3_検査記録==2|  検査_4_検査記録==2) %>%
filter(診断日 >= "2021-03-01") %>%
arrange(診断日)
return(d_)
}
d0 <- get_load_df(paste("./hersys_rawdata/hersys21",today,"取扱注意-0-2.csv",sep = ""))
d1 <- get_load_df(paste("./hersys_rawdata/hersys21",today,"取扱注意-3-5.csv",sep = ""))
d2 <- get_load_df(paste("./hersys_rawdata/hersys21",today,"取扱注意-6.csv",sep = ""))
d3 <- get_load_df(paste("./hersys_rawdata/hersys21",today,"取扱注意-7.csv",sep = ""))
get_load_df <- function(file_pass){
d_ <- read.csv(file(file_pass,encoding='cp932')) %>%
rename(ID = "HER.SYS.ID.ID管理",
年齢 = "年齢_歳.発生届",
生年月日 = "生年月日.ID管理",
性別 = "性別.発生届",
居住都道府県 = "都道府県.ID管理",
居住市区町村 = "居所の住所_市区町村.ID管理",
発症日 = "発病年月日.発生届",
診断日 = "診断年月日.発生届",
報告日 = "報告年月日.発生届",
感染推定日 = "感染推定日.発生届",
症状_発熱 = "症状等_発熱.発生届",
症状_咳 = "症状等_咳.発生届",
症状_咳以外の急性呼吸器症状 = "症状等_咳以外の急性呼吸器症状.発生届",
症状_肺炎像 = "症状等_肺炎像.発生届",
症状_重篤な肺炎 = "症状等_重篤な肺炎.発生届",
症状_急性呼吸窮迫症候群 = "症状等_急性呼吸窮迫症候群.発生届",
症状_多臓器不全 = "症状等_多臓器不全.発生届",
症状_全身倦怠感 = "症状等_全身倦怠感.発生届",
症状_頭痛 = "症状等_頭痛.発生届",
症状_嘔気嘔吐 = "症状等_嘔気.嘔吐.発生届",
症状_下痢 = "症状等_下痢.発生届",
症状_結膜炎 = "症状等_結膜炎.発生届",
症状_嗅覚味覚障害 = "症状等_嗅覚.味覚障害.発生届",
症状_その他 = "症状等_その他症状.発生届",
入院の必要性 = "入院の必要性.基礎情報",
検体採取日 = "PCR検体採取_日付.措置判定記録",
入院日_発生届 = "入院年月日.発生届",
入院日_医療連携情報= "入院_入院日付.医療連携情報",
入院日_措置判定記録 = "入院_日付.措置判定記録",
退院日_医療連携情報 = "入院_退院日付.医療連携情報",
退院日_措置判定記録 = "退院_日付.措置判定記録",
死亡日_医療連携情報 = "入院_死亡年月日.医療連携情報",
死亡日_措置判定記録 = "死亡_日付.措置判定記録",
外来機関コード_検査記録 = "外来機関コード.検査記録",
検査機関コード_検査記録 = "検査機関コード.検査記録",
診断医療機関コード_医療連携情報 = "診断_診断医療機関コード.医療連携情報",
入院病院コード = "入院_病院コード.医療連携情報",
届出保健所コード = "届出先保健所コード.発生届",
担当保健所コード = "担当保健所コード.ID管理",
感染経路_飛沫飛沫核感染 = "感染経路_フラグ.飛沫.飛沫核感染..発生届",
感染経路_接触感染 = "感染経路_フラグ.接触感染..発生届",
感染経路_その他 = "感染経路_フラグ.その他..発生届",
感染地域_確度 = "感染地域_確度コード.発生届",
感染経路_確度 = "感染経路_確度コード.発生届",
推定感染地域_都道府県コード = "感染地域_国内_都道府県コード.発生届",
推定感染地域_市区町村コード = "感染地域_国内_市区町村コード.発生届",
推定感染地域_場所区分 = "感染地域_国内_場所区分コード.発生届",
推定感染地域_国コード = "感染地域_国外_国コード.発生届",
リンク有無 = "リンクの有無.発生届",
検査_1_発生届 = "検査記録_検査1_検査結果.発生届",
検査_2_発生届 = "検査記録_検査2_検査結果.発生届",
検査_3_発生届 = "検査記録_検査3_検査結果.発生届",
検査_4_発生届 = "検査記録_検査4_検査結果.発生届",
検査_1_検査記録 = "検査1_検査結果.検査記録",
検査_2_検査記録 = "検査2_検査結果.検査記録",
検査_3_検査記録 = "検査3_検査結果.検査記録",
検査_4_検査記録 = "検査4_検査結果.検査記録",
検査方法1_検査記録 = "検査1_検査方法.検査記録",
検査方法2_検査記録 = "検査2_検査方法.検査記録",
検査方法3_検査記録 = "検査3_検査方法.検査記録",
検査方法4_検査記録 = "検査4_検査方法.検査記録",
検査方法1_発生届 = "検査記録_検査1_検査方法.発生届",
検査方法2_発生届 = "検査記録_検査2_検査方法.発生届",
検査方法3_発生届 = "検査記録_検査3_検査方法.発生届",
検査方法4_発生届 = "検査記録_検査4_検査方法.発生届",
検査検体1_検査記録 = "検査1_検体.検査記録",
検査検体2_検査記録 = "検査2_検体.検査記録",
検査検体3_検査記録 = "検査3_検体.検査記録",
検査検体4_検査記録 = "検査4_検体.検査記録",
検査検体1_発生届 = "検査記録_検査1_検体.発生届",
検査検体2_発生届 = "検査記録_検査2_検体.発生届",
検査検体3_発生届 = "検査記録_検査3_検体.発生届",
検査検体4_発生届 = "検査記録_検査4_検体.発生届",
診断類型 = "診断類型.発生届",
現在のステータス = "現在のステータス.措置判定記録"
) %>%
mutate(届出保健所コード=as.numeric(届出保健所コード),
担当保健所コード=as.numeric(担当保健所コード)) %>%
mutate_at(vars(発症日,診断日,報告日,生年月日,感染推定日),~as.Date(.)) %>%
filter(診断類型==1|診断類型==2|診断類型==4|
検査_1_発生届==2|  検査_2_発生届==2|  検査_3_発生届==2|  検査_4_発生届==2|
検査_1_検査記録==2|  検査_2_検査記録==2|  検査_3_検査記録==2|  検査_4_検査記録==2) %>%
filter(診断日 >= "2021-03-01") %>%
arrange(診断日) %>%
left_join(d_id_対応,by="ID") %>%
left_join(df_hc_届出,by="届出保健所コード") %>%
left_join(df_hc_担当,by="担当保健所コード") %>%
dplyr::select(ID,hs_id,年齢,生年月日,性別,居住都道府県,居住市区町村,検体採取日,発症日,診断日,報告日,感染推定日,届出保健所都道府県,届出保健所,担当保健所都道府県,担当保健所,
症状_発熱,症状_咳,症状_咳以外の急性呼吸器症状,症状_肺炎像,症状_重篤な肺炎,症状_急性呼吸窮迫症候群,症状_多臓器不全,
症状_全身倦怠感,症状_頭痛,症状_嘔気嘔吐,症状_下痢,症状_結膜炎,症状_嗅覚味覚障害,症状_その他,入院の必要性,
感染経路_飛沫飛沫核感染,感染経路_接触感染,感染経路_その他,感染経路_確度,感染地域_確度,
推定感染地域_都道府県コード,推定感染地域_市区町村コード,推定感染地域_場所区分,推定感染地域_国コード,リンク有無,
入院日_発生届,入院日_医療連携情報,入院日_措置判定記録,退院日_医療連携情報,退院日_措置判定記録,死亡日_医療連携情報,死亡日_措置判定記録,
外来機関コード_検査記録,検査機関コード_検査記録,診断医療機関コード_医療連携情報,入院病院コード,
検査_1_発生届,検査_2_発生届,検査_3_発生届,検査_4_発生届,検査_2_検査記録,検査_3_検査記録,検査_4_検査記録,
検査検体1_検査記録,検査検体2_検査記録,検査検体3_検査記録,検査検体4_検査記録,検査検体1_発生届,検査検体2_発生届,検査検体3_発生届,検査検体4_発生届,
診断類型,現在のステータス,
検査方法1_検査記録,検査方法2_検査記録,検査方法3_検査記録,検査方法4_検査記録,
検査方法1_発生届,検査方法2_発生届,検査方法3_発生届,検査方法4_発生届)
return(d_)
}
d0 <- get_load_df(paste("./hersys_rawdata/hersys21",today,"取扱注意-0-2.csv",sep = ""))
d1 <- get_load_df(paste("./hersys_rawdata/hersys21",today,"取扱注意-3-5.csv",sep = ""))
d2 <- get_load_df(paste("./hersys_rawdata/hersys21",today,"取扱注意-6.csv",sep = ""))
d3 <- get_load_df(paste("./hersys_rawdata/hersys21",today,"取扱注意-7.csv",sep = ""))
d <- rbind(d0,d1,d2,d3)
df <- d %>%
filter(!is.na(hs_id)|
str_detect(届出保健所,"札幌|仙台|福岡|大津市|横浜") | 届出保健所 == "大阪市保健所" |
str_detect(届出保健所都道府県,"青森|岩手|福島|千葉|富山|愛知|岐阜|和歌山|奈良|岡山|福岡")) %>%
# str_detect(担当保健所都道府県,"青森|岩手|福島|千葉|富山|愛知|岐阜|和歌山|奈良|岡山|福岡")|
# str_detect(居住都道府県,"青森|岩手|福島|千葉|富山|愛知|岐阜|和歌山|奈良|岡山|福岡")|
# str_detect(届出保健所,"横浜")
# str_detect(担当保健所,"横浜")|
# str_detect(居住市区町村,"横浜")
# ) %>%
arrange(hs_id) %>%
mutate(hs_id_num = str_extract(hs_id,"\\d+")) %>%
mutate(max = as.numeric(max(hs_id_num,na.rm = T)))
df_1 <- df %>%
filter(hs_id_num != max & !is.na(hs_id_num))
df_2 <- df %>%
filter(hs_id_num == max | is.na(hs_id_num)) %>%
# mutate(num=row_number()) %>%
mutate(hs_id_num = row_number()+max-1) %>%
mutate(hs_id = paste("hs",hs_id_num,sep=""))
df_final <- rbind(df_1,df_2)
df_抽出 <- df_final %>%
left_join(df_pref_2,by="推定感染地域_都道府県コード") %>%
left_join(df_市区町村) %>%
left_join(df_国) %>%
dplyr::select(ID,hs_id,年齢,性別,届出保健所都道府県,届出保健所,発症日,診断日,感染推定日,報告日,感染経路_飛沫飛沫核感染,感染経路_接触感染,感染経路_その他,
感染経路_確度,感染地域_確度,推定感染地域_都道府県,推定感染地域_市区町村,推定感染地域_国,
診断類型,
検査方法1_検査記録,検査方法2_検査記録,検査方法3_検査記録,検査方法4_検査記録,
検査方法1_発生届,検査方法2_発生届,検査方法3_発生届,検査方法4_発生届,
検査検体1_検査記録,検査検体2_検査記録,検査検体3_検査記録,検査検体4_検査記録,検査検体1_発生届,検査検体2_発生届,検査検体3_発生届,検査検体4_発生届,
症状_発熱,症状_咳,症状_咳以外の急性呼吸器症状,症状_肺炎像,症状_重篤な肺炎,症状_急性呼吸窮迫症候群,症状_多臓器不全,
症状_全身倦怠感,症状_頭痛,症状_嘔気嘔吐,症状_下痢,症状_結膜炎,症状_嗅覚味覚障害,症状_その他)
df_combine <- rbind(df_抽出 %>% dplyr::select(-ID),df_前回) %>%
distinct(hs_id,.keep_all = T) %>%
arrange(hs_id)
df_ID対応_combine <- rbind(df_抽出 %>% dplyr::select(ID,hs_id),d_id_対応) %>%
distinct(hs_id,.keep_all = T) %>%
arrange(hs_id)
write_xlsx(df_ID対応_combine,paste("./下水/下水サーベイデータID対応_",Sys.Date(),".xlsx",sep = ""))
write_xlsx(
x = list(
Data = df_combine,
Data_dictionary = df_dict),
paste("./下水/下水サーベイ共有データ_",Sys.Date(),".xlsx",sep = ""))
